
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/DataTables/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
    <style>
        span.field-validation-error {
            color: red;
        }


        .blur {
            opacity: 0.3;
            pointer-events: none;
            background-color: #d9d9d9
        }

        .overlay {
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            position: absolute;
        }
        .ui-dialog {
            padding: 0;
        }
        .ui-dialog .ui-dialog-title {
            margin: 10px 10px;
        }
        .ui-dialog .ui-dialog-titlebar {
            margin-bottom: 15px;
        }
        .ui-dialog .ui-dialog-buttonpane {
            
            margin-top: 0;
            
        }
        .ui-corner-all, .ui-corner-bottom, .ui-corner-right, .ui-corner-br {
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
            border-top-right-radius: 0;
            border-top-left-radius: 0;
        }

        .pagination {
            margin: 10px 0 !important;
        }
    </style>
</head>
<body>

    <div class="overlay">
        <br />
        <br />
        <div class="container">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <strong style="font-size: 25px">Jquery Datables</strong>
                    <a class="popup btn btn-success pull-right" href="@Url.Action("Save","Home", new {id = 0})">Add New Employee</a>
                </div>
                <div class="panel-body">
                    <table class="table table-bordered" id="myDatatable">
                        <thead>
                            <tr>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Email</th>
                                <th>City</th>
                                <th>Country</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <br />



    <script src="~/Scripts/jquery-3.1.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Scripts/DataTatables/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/DataTatables/dataTables.bootstrap.min.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>

    <script>
        $(document).ready(function () {


            var oTable = $('#myDatatable').DataTable({
                "scrollX": true,
                "ajax": {
                    "url": '/home/GetEmployees',
                    "type": "get",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "FirstName", "width": "200px" },
                    { "data": "LastName", "width": "100px" },
                    { "data": "Email", "width": "200px" },
                    { "data": "City", "width": "100px" },
                    { "data": "Country", "width": "120px" },
                    {
                        "data": "EmployeeId",
                        "width": "50px",
                        "render": function (data) {
                            return '<a class="popup" href="/home/save/' + data + '">Edit</a>';
                        }
                    },
                    {
                        "data": "EmployeeId",
                        "width": "50px",
                        "render": function (data) {
                            return '<a class="popup" href="/home/delete/' + data + '">Delete</a>';
                        }
                    }
                ]
            });

            var $dialog;
            function openPopup(pageUrl) {
                var $pageContent = $('<div/>');
                $pageContent.load(pageUrl, function () {
                    $('#popupForm', $pageContent).removeData('validator');
                    $('#popupForm', $pageContent).removeData('unobtrusiveValidation');
                    $.validator.unobtrusive.parse('form');

                });
                
                $('.overlay').addClass("blur");
                $dialog = $('<div class="popupWindow" style="overflow:auto"></div>')
                    .html($pageContent)
                    .dialog({
                        draggable: false,
                        autoOpen: false,
                        show: {
                            effect: "slide",
                            duration: 700
                        },
                        hide: {
                            effect: "explode",
                            duration: 500
                        },
                        resizable: false,
                        model: true,
                        buttons: {
                            "Submit": function(e) {
                                $("#popupForm").submit();
                            },
                            Cancel: function() {
                                $dialog.dialog( "close" );
                            }
                        },
                        position: { my: "center", at: "top+100" },
                        overlay: { opacity: 0.9, background: "black" },
                        //title: "",
                        height: 'auto',
                        width: 700,
                        
                        close: function () {
                            $dialog.dialog('destroy').remove();
                            $('.overlay').removeClass("blur");
                        }
                    });

                $('.popupWindow').on('submit', '#popupForm', function (e) {
                    var url = $('#popupForm')[0].action;
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: $('#popupForm').serialize(),
                        success: function (data) {
                            if (data.status) {
                                $dialog.dialog('close');
                                oTable.ajax.reload();
                            }
                        }
                    });

                    e.preventDefault();
                });

                $dialog.dialog('open');
            }

            $('.panel-heading').on('click', 'a.popup', function (e) {
                e.preventDefault();
                openPopup($(this).attr('href'));
                $dialog.dialog({ title: "Create New Employee" });
            });
            $('#myDatatable').on('click', 'a.popup', function (e) {
                e.preventDefault();
                openPopup($(this).attr('href'));
                $dialog.dialog({ title: "Update Employee" });
            });


        });
    </script>
</body>
</html>
